---
import { getCollection, type CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import { formatListDate } from "../lib/dates";
import { normalizeMedium } from "../lib/reviews";

const blogPosts = await getCollection("blog");
const reviewPosts = await getCollection("reviews");
const recent = [
  ...blogPosts.map((post: CollectionEntry<"blog">) => ({
    title: post.data.title,
    date: post.data.pubDate,
    href: `/blog/${post.id}/`,
    kind: "Blog",
  })),
  ...reviewPosts.map((post: CollectionEntry<"reviews">) => ({
    title: post.data.title,
    date: post.data.pubDate,
    href: `/reviews/${normalizeMedium(post.data.medium)}/${post.id}/`,
    kind: "Review",
  })),
]
  .sort((a, b) => b.date.valueOf() - a.date.valueOf())
  .slice(0, 10);
---

<BaseLayout title="Home">
  <h1>Recent</h1>

  <ul>
    {recent.map((post) => (
      <li>
        <a href={post.href}>{post.title}</a>
        {" "}
        <span>({post.kind})</span>
        {" "}
        <span class="list-date">{formatListDate(post.date)}</span>
      </li>
    ))}
  </ul>
</BaseLayout>
