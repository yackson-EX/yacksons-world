---
import BaseLayout from "../../layouts/BaseLayout.astro";

const { slug } = Astro.params;
const BACKEND_URL = import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:3001';

let post = null;

try {
  const response = await fetch(`${BACKEND_URL}/api/blogs/${slug}`);
  if (response.ok) {
    post = await response.json();
  }
} catch (error) {
  console.error('Failed to fetch blog post:', error);
}

if (!post) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={post.title}>
  <a href="/blog/">Back</a>
  <h1>{post.title}</h1>
  {post.category && <p><em>Category: {post.category}</em></p>}
  <time>{new Date(post.pub_date).toLocaleDateString()}</time>
  <div set:html={post.content} />
</BaseLayout>